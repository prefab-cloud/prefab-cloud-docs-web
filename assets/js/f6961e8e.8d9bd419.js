"use strict";(self.webpackChunkprefab_cloud_docs_web=self.webpackChunkprefab_cloud_docs_web||[]).push([[4877],{684:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var r=t(4848),s=t(8453);const i={title:"JavaScript"},l=void 0,o={id:"sdks/javascript",title:"JavaScript",description:"If you're using React, consider using our [React Client] instead.",source:"@site/docs/sdks/javascript.md",sourceDirName:"sdks",slug:"/sdks/javascript",permalink:"/docs/sdks/javascript",draft:!1,unlisted:!1,editUrl:"https://github.com/prefab-cloud/prefab-cloud-docs-web/tree/main/docs/sdks/javascript.md",tags:[],version:"current",frontMatter:{title:"JavaScript"},sidebar:"tutorialSidebar",previous:{title:"Java",permalink:"/docs/sdks/java"},next:{title:"Node",permalink:"/docs/sdks/node/"}},d={},c=[{value:"Install the latest version",id:"install-the-latest-version",level:2},{value:"Initialize the client",id:"initialize-the-client",level:2},{value:"Feature Flags",id:"feature-flags",level:2},{value:"Context",id:"context",level:2},{value:"<code>poll()</code>",id:"poll",level:2},{value:"Dynamic Config",id:"dynamic-config",level:2},{value:"Dynamic Logging",id:"dynamic-logging",level:2},{value:"Tracking Experiment Exposures",id:"tracking-experiment-exposures",level:2},{value:"Telemetry",id:"telemetry",level:2},{value:"Testing",id:"testing",level:2},{value:"Reference",id:"reference",level:2},{value:"<code>prefab</code> Properties",id:"prefab-properties",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components},{TabItem:t,Tabs:i}=n;return t||x("TabItem",!0),i||x("Tabs",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["If you're using React, consider using our ",(0,r.jsx)(n.a,{href:"/docs/sdks/react",children:"React Client"})," instead."]})}),"\n",(0,r.jsx)(n.h2,{id:"install-the-latest-version",children:"Install the latest version"}),"\n",(0,r.jsxs)(n.p,{children:["Use your favorite package manager to install ",(0,r.jsx)(n.code,{children:"@prefab-cloud/prefab-cloud-js"})," ",(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@prefab-cloud/prefab-cloud-js",children:"npm"})," | ",(0,r.jsx)(n.a,{href:"https://github.com/prefab-cloud/prefab-cloud-js",children:"github"})]}),"\n",(0,r.jsxs)(i,{groupId:"lang",children:[(0,r.jsxs)(t,{value:"npm",label:"npm",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install @prefab-cloud/prefab-cloud-js\n"})}),(0,r.jsx)(n.p,{children:"TypeScript types are included with the package."})]}),(0,r.jsxs)(t,{value:"yarn",label:"yarn",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"yarn add @prefab-cloud/prefab-cloud-js\n"})}),(0,r.jsx)(n.p,{children:"TypeScript types are included with the package."})]}),(0,r.jsxs)(t,{value:"script",label:"<script> tag",children:[(0,r.jsx)(n.p,{children:"We recommend using [jsDelivr][jsDelivr] for a minified/bundled version."}),(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)("a",{href:"#context",children:"context"})," section for more information on how to initialize with the ",(0,r.jsx)(n.code,{children:"<script>"})," tag."]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"initialize-the-client",children:"Initialize the client"}),"\n",(0,r.jsxs)(n.p,{children:["Initialize ",(0,r.jsx)(n.code,{children:"prefab"})," with your api key:"]}),"\n",(0,r.jsxs)(i,{groupId:"lang",children:[(0,r.jsxs)(t,{value:"import",label:"import",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import { prefab } from "@prefab-cloud/prefab-cloud-js";\n\nconst options = {\n  apiKey: "YOUR_CLIENT_API_KEY",\n};\n\nawait prefab.init(options);\n'})}),(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"prefab.init"})," will request the calculated feature flags for the provided context as a single HTTPS request. If you need to check for updates to feature flag values, you can ",(0,r.jsx)(n.a,{href:"#poll",children:"learn more about polling"})," below."]}),(0,r.jsxs)(n.p,{children:["You aren't required to ",(0,r.jsx)(n.code,{children:"await"})," the ",(0,r.jsx)(n.code,{children:"init"})," -- it is a promise, so you can use ",(0,r.jsx)(n.code,{children:".then"}),", ",(0,r.jsx)(n.code,{children:".finally"}),", ",(0,r.jsx)(n.code,{children:".catch"}),", etc. instead if you prefer."]})]}),(0,r.jsx)(t,{value:"script",label:"<script> tag",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// `prefab` is available globally on the window object\nconst options = {\n  apiKey: "YOUR_CLIENT_API_KEY",\n};\n\nprefab.init(options).then(() => {\n  console.log(options);\n  console.log("test-flag is " + prefab.isEnabled("test-flag"));\n});\n'})})})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["While ",(0,r.jsx)(n.code,{children:"prefab"})," is loading, ",(0,r.jsx)(n.code,{children:"isEnabled"})," will return ",(0,r.jsx)(n.code,{children:"false"}),", ",(0,r.jsx)(n.code,{children:"get"})," will return ",(0,r.jsx)(n.code,{children:"undefined"}),", and ",(0,r.jsx)(n.code,{children:"shouldLog"})," will use your ",(0,r.jsx)(n.code,{children:"defaultLevel"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"feature-flags",children:"Feature Flags"}),"\n",(0,r.jsxs)(n.p,{children:["Now you can use ",(0,r.jsx)(n.code,{children:"prefab"}),"'s feature flag evaluation, e.g."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"if (prefab.isEnabled('cool-feature') {\n  // ... this code only evaluates if `cool-feature` is enabled for the current context\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can also use ",(0,r.jsx)(n.code,{children:"get"})," to access the value of non-boolean flags"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const stringValue = prefab.get("my-string-flag");\n'})}),"\n",(0,r.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Context"})," accepts an object with keys that are context names and key value pairs with attributes describing the context. You can use this to write targeting rules, e.g. ",(0,r.jsx)(n.a,{href:"/docs/explanations/features/rules-and-segmentation",children:"segment"})," your users."]}),"\n",(0,r.jsxs)(i,{groupId:"lang",children:[(0,r.jsx)(t,{value:"import",label:"import",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// highlight-next-line\nimport { prefab, Context } from "@prefab-cloud/prefab-cloud-js";\n\nconst options = {\n  apiKey: "YOUR_CLIENT_API_KEY",\n  // highlight-start\n  context: new Context({\n    user: { key: "abcdef", email: "test@example.com" },\n    device: { key: "hijklm", mobile: true },\n  }),\n  // highlight-end\n};\n\nawait prefab.init(options);\n'})})}),(0,r.jsx)(t,{value:"script",label:"<script> tag",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'// `prefab` is available globally on the window object\n// `Context` is available globally as `window.prefabNamespace.Context`\nconst options = {\n  apiKey: "YOUR_CLIENT_API_KEY",\n  // highlight-start\n  context: new prefabNamespace.Context({\n    user: {\n      email: "test@example.com",\n    },\n    device: { mobile: true },\n  }),\n  // highlight-end\n};\n\nprefab.init(options).then(() => {\n  console.log(options);\n  console.log("test-flag is " + prefab.isEnabled("test-flag"));\n\n  console.log("ex1-copywrite " + prefab.get("ex1-copywrite"));\n  $(".copywrite").text(prefab.get("ex1-copywrite"));\n});\n'})})})]}),"\n",(0,r.jsx)(n.h2,{id:"poll",children:(0,r.jsx)(n.code,{children:"poll()"})}),"\n",(0,r.jsxs)(n.p,{children:["After ",(0,r.jsx)(n.code,{children:"prefab.init()"}),", you can start polling. Polling uses the context you defined in ",(0,r.jsx)(n.code,{children:"init"})," by default. You can update the context for future polling by setting it on the ",(0,r.jsx)(n.code,{children:"prefab"})," object."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// some time after init\nprefab.poll({ frequencyInMs: 300000 });\n\n// we're now polling with the context used from `init`\n\n// later, perhaps after a visitor logs in and now you have the context of\n// their current user\nprefab.updateContext({\n  ...prefab.context,\n  user: { email: user.email, key: user.trackingId },\n});\n\n// updateContext will immediately load the newest from Prefab based on the\n// new context. Future polling will use the new context as well.\n"})}),"\n",(0,r.jsx)(n.h2,{id:"dynamic-config",children:"Dynamic Config"}),"\n",(0,r.jsxs)(n.p,{children:["Config values are accessed the same way as feature flag values. You can use ",(0,r.jsx)(n.code,{children:"isEnabled"})," as a convenience for boolean values, and ",(0,r.jsx)(n.code,{children:"get"})," works for all data types."]}),"\n",(0,r.jsx)(n.p,{children:'By default configs are not sent to client SDKs. You must enable access for each individual config. You can do this by checking the "Send to client SDKs" checkbox when creating or editing a config.'}),"\n",(0,r.jsx)(n.h2,{id:"dynamic-logging",children:"Dynamic Logging"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"shouldLog"})," allows you to implement dynamic logging. It takes the following properties:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"property"}),(0,r.jsx)(n.th,{children:"type"}),(0,r.jsx)(n.th,{children:"example"}),(0,r.jsx)(n.th,{children:"case-sensitive"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"loggerName"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"my.corp.widgets.modal"}),(0,r.jsx)(n.td,{children:"Yes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"desiredLevel"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"INFO"}),(0,r.jsx)(n.td,{children:"No"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"defaultLevel"})}),(0,r.jsx)(n.td,{children:"string"}),(0,r.jsx)(n.td,{children:"ERROR"}),(0,r.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["If you've configured a level value for ",(0,r.jsx)(n.code,{children:"loggerName"}),' (or a parent in the dot-notation hierarchy like "my.corp.widgets") then that value will be used for comparison against the ',(0,r.jsx)(n.code,{children:"desiredLevel"}),". If no configured level is found in the hierarchy for ",(0,r.jsx)(n.code,{children:"loggerName"})," then the provided ",(0,r.jsx)(n.code,{children:"defaultLevel"})," will be compared against ",(0,r.jsx)(n.code,{children:"desiredLevel"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"desiredLevel"})," is greater than or equal to the comparison severity, then ",(0,r.jsx)(n.code,{children:"shouldLog"})," returns true. If the ",(0,r.jsx)(n.code,{children:"desiredLevel"})," is less than the comparison severity, then ",(0,r.jsx)(n.code,{children:"shouldLog"})," will return false."]}),"\n",(0,r.jsx)(n.p,{children:"Example usage:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'const desiredLevel = "info";\nconst defaultLevel = "error";\nconst loggerName = "my.corp.widgets.modal";\n\nif (shouldLog({ loggerName, desiredLevel, defaultLevel })) {\n  console.info("...");\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:['If no log level value is configured in Prefab for "my.corp.widgets.modal" or higher in the hierarchy, then the ',(0,r.jsx)(n.code,{children:"console.info"})," will not happen. If the value is configured and is INFO or more verbose, the ",(0,r.jsx)(n.code,{children:"console.info"})," will happen."]}),"\n",(0,r.jsx)(n.h2,{id:"tracking-experiment-exposures",children:"Tracking Experiment Exposures"}),"\n",(0,r.jsxs)(n.p,{children:["If you're using ",(0,r.jsx)(n.a,{href:"/docs/how-tos/experiment",children:"Prefab for A/B testing"}),", you can supply code for tracking experiment exposures to your data warehouse or analytics tool of choice."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import { prefab, Context } from "@prefab-cloud/prefab-cloud-js";\n\nconst options = {\n  apiKey: "YOUR_CLIENT_API_KEY",\n  context: new Context({\n    user: { key: "abcdef", email: "test@example.com" },\n    device: { key: "hijklm", mobile: true },\n  }),\n  // highlight-start\n  afterEvaluationCallback: (key, value) => {\n    // call your analytics tool here...in this example we are sending data to posthog\n    window.posthog?.capture("Feature Flag Evaluation", {\n      key,\n      value,\n    });\n  },\n  // highlight-end\n};\n\nawait prefab.init(options);\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"afterEvaluationCallback"})," will be called each time you evaluate a feature flag or config using ",(0,r.jsx)(n.code,{children:"get"})," or ",(0,r.jsx)(n.code,{children:"isEnabled"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"telemetry",children:"Telemetry"}),"\n",(0,r.jsxs)(n.p,{children:["By default, Prefab will collect summary counts of config and feature flag evaluations to help you understand how your configs and flags are being used in the real world. You can opt out of this behavior by passing ",(0,r.jsx)(n.code,{children:"collectEvaluationSummaries: false"})," in the options to ",(0,r.jsx)(n.code,{children:"prefab.init"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Prefab also stores the context that you pass in. The context keys are used to power autocomplete in the rule editor, and the individual values power the Contexts page for troubleshooting targeting rules and individual flag overrides. If you want to change what Prefab stores, you can pass a different value for ",(0,r.jsx)(n.code,{children:"collectContextMode"}),"."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.th,{children:[(0,r.jsx)(n.code,{children:"collectContextMode"})," value"]}),(0,r.jsx)(n.th,{children:"Behavior"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PERIODIC_EXAMPLE"})}),(0,r.jsx)(n.td,{children:"Stores context values and context keys. This is the default."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"SHAPE_ONLY"})}),(0,r.jsx)(n.td,{children:"Stores context keys only."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"NONE"})}),(0,r.jsx)(n.td,{children:"Stores nothing. Context will only be used for rule evaluation."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,r.jsxs)(n.p,{children:["In your test suite, you should skip ",(0,r.jsx)(n.code,{children:"prefab.init"})," altogether and instead use ",(0,r.jsx)(n.code,{children:"prefab.setConfig"})," to set up your test state."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'it("shows the turbo button when the feature is enabled", () => {\n  prefab.setConfig({\n    turbo: true,\n    defaultMediaCount: 3,\n  });\n\n  const rendered = new MyComponent().render();\n\n  expect(rendered).toMatch(/Enable Turbo/);\n  expect(rendered).toMatch(/Media Count: 3/);\n});\n'})}),"\n",(0,r.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,r.jsxs)(n.h3,{id:"prefab-properties",children:[(0,r.jsx)(n.code,{children:"prefab"})," Properties"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"property"}),(0,r.jsx)(n.th,{children:"example"}),(0,r.jsx)(n.th,{children:"purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"isEnabled"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'prefab.isEnabled("new-logo")'})}),(0,r.jsxs)(n.td,{children:["returns a boolean (default ",(0,r.jsx)(n.code,{children:"false"}),") if a feature is enabled based on the current context"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"get"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.get('retry-count')"})}),(0,r.jsx)(n.td,{children:"returns the value of a flag or config evaluated in the current context"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"loaded"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"if (prefab.loaded) { ... }"})}),(0,r.jsx)(n.td,{children:"a boolean indicating whether prefab content has loaded"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"shouldLog"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"if (prefab.shouldLog(...)) {"})}),(0,r.jsx)(n.td,{children:"returns a boolean indicating whether the proposed log level is valid for the current context"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"poll"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.poll({frequencyInMs})"})}),(0,r.jsxs)(n.td,{children:["starts polling every ",(0,r.jsx)(n.code,{children:"frequencyInMs"})," ms."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"stopPolling"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.stopPolling()"})}),(0,r.jsx)(n.td,{children:"stops the polling process"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"context"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.context"})}),(0,r.jsxs)(n.td,{children:["get the current context (after ",(0,r.jsx)(n.code,{children:"init()"}),")."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"updateContext"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.updateContext(newContext)"})}),(0,r.jsxs)(n.td,{children:["update the context and refetch. Pass ",(0,r.jsx)(n.code,{children:"false"})," as a second argument to skip refetching"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"extract"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.extract()"})}),(0,r.jsx)(n.td,{children:"returns the current config as a plain object of key, config value pairs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"hydrate"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"prefab.hydrate(configurationObject)"})}),(0,r.jsx)(n.td,{children:"sets the current config based on a plain object of key, config value pairs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["[jsDelivr]: ",(0,r.jsx)(n.a,{href:"https://www.jsdelivr.com/package/npm/@prefab-cloud/prefab-cloud-js",children:"https://www.jsdelivr.com/package/npm/@prefab-cloud/prefab-cloud-js"})]}),(0,r.jsx)(n.td,{}),(0,r.jsx)(n.td,{})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}function x(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var r=t(6540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);