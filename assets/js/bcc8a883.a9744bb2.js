"use strict";(self.webpackChunkprefab_cloud_docs_web=self.webpackChunkprefab_cloud_docs_web||[]).push([[551],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),p=u(n),f=r,m=p["".concat(s,".").concat(f)]||p[f]||d[f]||l;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=f;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,o[1]=i;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},4866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(7462),r=n(7294),l=n(6010),o=n(2466),i=n(6550),s=n(1980),u=n(7392),c=n(12);function p(e){return function(e){return r.Children.map(e,(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function d(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function f(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:n}=e;const a=(0,i.k6)(),l=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(l),(0,r.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(a.location.search);t.set(l,e),a.replace({...a.location,search:t.toString()})}),[l,a])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,l=d(e),[o,i]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!f({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:l}))),[s,u]=m({queryString:n,groupId:a}),[p,g]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,l]=(0,c.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&l.set(e)}),[n,l])]}({groupId:a}),b=(()=>{const e=s??p;return f({value:e,tabValues:l})?e:null})();(0,r.useLayoutEffect)((()=>{b&&i(b)}),[b]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!f({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),g(e)}),[u,g,l]),tabValues:l}}var b=n(2389);const h={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:n,selectedValue:i,selectValue:s,tabValues:u}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.o5)(),d=e=>{const t=e.currentTarget,n=c.indexOf(t),a=u[n].value;a!==i&&(p(t),s(a))},f=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=c.indexOf(e.currentTarget)+1;t=c[n]??c[0];break}case"ArrowLeft":{const n=c.indexOf(e.currentTarget)-1;t=c[n]??c[c.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:o}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,key:t,ref:e=>c.push(e),onKeyDown:f,onClick:d},o,{className:(0,l.Z)("tabs__item",h.tabItem,o?.className,{"tabs__item--active":i===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:a}=e;const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function k(e){const t=g(e);return r.createElement("div",{className:(0,l.Z)("tabs-container",h.tabList)},r.createElement(y,(0,a.Z)({},e,t)),r.createElement(v,(0,a.Z)({},e,t)))}function w(e){const t=(0,b.Z)();return r.createElement(k,(0,a.Z)({key:String(t)},e))}},1401:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=n(7462),r=(n(7294),n(3905)),l=n(4866);const o={title:"Default YAML Files",sidebar_label:"Default Files",sidebar_position:3},i=void 0,s={unversionedId:"explanations/defaults",id:"explanations/defaults",title:"Default YAML Files",description:"Default System",source:"@site/docs/explanations/defaults.md",sourceDirName:"explanations",slug:"/explanations/defaults",permalink:"/docs/explanations/defaults",draft:!1,editUrl:"https://github.com/prefab-cloud/prefab-cloud-docs-web/tree/main/docs/explanations/defaults.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Default YAML Files",sidebar_label:"Default Files",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Context",permalink:"/docs/explanations/context"},next:{title:"Reliability",permalink:"/docs/explanations/resiliency"}},u={},c=[{value:"Default System",id:"default-system",level:2},{value:"Nesting",id:"nesting",level:3},{value:"Feature Flags",id:"feature-flags",level:3},{value:"Prefab Environments",id:"prefab-environments",level:2},{value:"Deleting Values",id:"deleting-values",level:2}],p=(d="TabItem",function(e){return console.warn("Component "+d+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var d;const f={toc:c},m="wrapper";function g(e){let{components:t,...n}=e;return(0,r.kt)(m,(0,a.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"default-system"},"Default System"),(0,r.kt)("p",null,"Prefab has a powerful system of environment defaults that allows you to get started quickly. Let's look."),(0,r.kt)("p",null,"The first file is ",(0,r.kt)("inlineCode",{parentName:"p"},".prefab.default.config.yaml"),". Prefab will always look for and load a file with this name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'# .prefab.default.config.yaml\nlog-level:\n  _: info\n  myapp.controllers:\n    _: debug\n    chatty_controller: warn\n  google.apis.core.http_command: info\n\napi-usage: { "feature_flag": "true", value: true }\n\nredis.url: "redis://localhost:6379"\n\ngoogle:\n  gcp:\n    _: my-staging-project # share the staging project in development\n    big-query:\n      dataset-name: development-dataset # but use a development dataset\n')),(0,r.kt)("p",null,"There are a number of things to note in this example. "),(0,r.kt)("h3",{id:"nesting"},"Nesting"),(0,r.kt)("p",null,"In order to reduce redundant keys, Prefab default files support nesting. In the example above you would access the GCP\ndataset name with the key ",(0,r.kt)("inlineCode",{parentName:"p"},"google.gcp.big-query.dataset-name"),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"_")," key is special and lets us specify a value with a key that has nested attributes. The GCP project ",(0,r.kt)("inlineCode",{parentName:"p"},"my-staging-project"),"\nin this example is accessible by the key ",(0,r.kt)("inlineCode",{parentName:"p"},"google.gcp"),"."),(0,r.kt)("h3",{id:"feature-flags"},"Feature Flags"),(0,r.kt)("p",null,"A handy shorthand for feature flags is available to set a default value."),(0,r.kt)("h2",{id:"prefab-environments"},"Prefab Environments"),(0,r.kt)("p",null,"You can optionally add a list of environments to load additional default files. Let's see how to load the files ",(0,r.kt)("inlineCode",{parentName:"p"},".prefab.staging.config.yaml"),"\nand ",(0,r.kt)("inlineCode",{parentName:"p"},".prefab.cloud.config.yaml")," in that order. "),(0,r.kt)(l.Z,{groupId:"lang",mdxType:"Tabs"},(0,r.kt)(p,{value:"ruby",label:"Ruby",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ruby"},'options = Prefab::Options.new(prefab_envs: Rails.env)\noptions = Prefab::Options.new(prefab_envs: ["staging", "cloud"])\n'))),(0,r.kt)(p,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'Options options = new Options()\n  .setPrefabEnvs(List.of("staging", "cloud"))\n'))),(0,r.kt)(p,{value:"shell",label:"Shell",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"PREFAB_ENVS=staging,cloud myapp\n")))),(0,r.kt)("p",null,"To continue our example from above. Let's look at how we might continue the logging and google configuration."),(0,r.kt)("p",null,"In staging, we no longer want the debug level of logging on our controllers. Let's turn that off.\nWe do want to change the big query dataset as well."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'# .prefab.staging.config.yaml\nlog-level:\n  myapp.controllers:\n    _: info # we will inherit levels from the default file unless overridden\n    \nredis.url: "redis://1.2.3.4:6379"\n\ngoogle:\n  gcp:\n    big-query:\n      dataset-name: staging-dataset\n')),(0,r.kt)("p",null,"In production, let's change all logging to warn and set both the google configurations to production values. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'# .prefab.production.config.yaml\nlog-level:\n  _: warn\n  myapp.controllers:\n    _: warn\n\nredis.url: "redis://7.8.9.10:6379"\n\ngoogle:\n  gcp:\n    _: my-production-project # use the production project\n    big-query:\n      dataset-name: production-dataset\n')),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"It's fine to use Prefab for configuration even if you don't think it will ever change.\nHaving it in Prefab means that you always retain the ability to update it on the fly.")),(0,r.kt)("h2",{id:"deleting-values"},"Deleting Values"),(0,r.kt)("p",null,"The Prefab clients will sometimes return nil even in the default mode. This situation occurs if you have deleted the keys in the Prefab UI.\nA deleted key value is sent down to the clients as a tombstone and this tombstone takes precedence over default values as indicated in the\n",(0,r.kt)("a",{parentName:"p",href:"/docs/explanations/bootstrapping"},"config load order")," doc."))}g.isMDXComponent=!0}}]);