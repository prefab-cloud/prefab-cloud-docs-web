"use strict";(self.webpackChunkprefab_cloud_docs_web=self.webpackChunkprefab_cloud_docs_web||[]).push([[247],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>m});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?l(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):l(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function u(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},l=Object.keys(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)a=l[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),i=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=i(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,l=e.originalType,s=e.parentName,c=u(e,["components","mdxType","originalType","parentName"]),p=i(a),h=n,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||l;return a?r.createElement(m,o(o({ref:t},c),{},{components:a})):r.createElement(m,o({ref:t},c))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var l=a.length,o=new Array(l);o[0]=h;var u={};for(var s in t)hasOwnProperty.call(t,s)&&(u[s]=t[s]);u.originalType=e,u[p]="string"==typeof e?e:n,o[1]=u;for(var i=2;i<l;i++)o[i]=a[i];return r.createElement.apply(null,o)}return r.createElement.apply(null,a)}h.displayName="MDXCreateElement"},5162:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(7294),n=a(6010);const l={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:a,className:o}=e;return r.createElement("div",{role:"tabpanel",className:(0,n.Z)(l.tabItem,o),hidden:a},t)}},4866:(e,t,a)=>{a.d(t,{Z:()=>w});var r=a(3117),n=a(7294),l=a(6010),o=a(2466),u=a(6775),s=a(1980),i=a(7392),c=a(12);function p(e){return function(e){var t,a;return null!=(t=null==(a=n.Children.map(e,(e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})))?void 0:a.filter(Boolean))?t:[]}(e).map((e=>{let{props:{value:t,label:a,attributes:r,default:n}}=e;return{value:t,label:a,attributes:r,default:n}}))}function d(e){const{values:t,children:a}=e;return(0,n.useMemo)((()=>{const e=null!=t?t:p(a);return function(e){const t=(0,i.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error('Docusaurus error: Duplicate values "'+t.map((e=>e.value)).join(", ")+'" found in <Tabs>. Every value needs to be unique.')}(e),e}),[t,a])}function h(e){let{value:t,tabValues:a}=e;return a.some((e=>e.value===t))}function m(e){let{queryString:t=!1,groupId:a}=e;const r=(0,u.k6)(),l=function(e){let{queryString:t=!1,groupId:a}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return null!=a?a:null}({queryString:t,groupId:a});return[(0,s._X)(l),(0,n.useCallback)((e=>{if(!l)return;const t=new URLSearchParams(r.location.search);t.set(l,e),r.replace({...r.location,search:t.toString()})}),[l,r])]}function f(e){const{defaultValue:t,queryString:a=!1,groupId:r}=e,l=d(e),[o,u]=(0,n.useState)((()=>function(e){var t;let{defaultValue:a,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(a){if(!h({value:a,tabValues:r}))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+a+'" but none of its children has the corresponding value. Available values are: '+r.map((e=>e.value)).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");return a}const n=null!=(t=r.find((e=>e.default)))?t:r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:l}))),[s,i]=m({queryString:a,groupId:r}),[p,f]=function(e){let{groupId:t}=e;const a=function(e){return e?"docusaurus.tab."+e:null}(t),[r,l]=(0,c.Nk)(a);return[r,(0,n.useCallback)((e=>{a&&l.set(e)}),[a,l])]}({groupId:r}),g=(()=>{const e=null!=s?s:p;return h({value:e,tabValues:l})?e:null})();(0,n.useLayoutEffect)((()=>{g&&u(g)}),[g]);return{selectedValue:o,selectValue:(0,n.useCallback)((e=>{if(!h({value:e,tabValues:l}))throw new Error("Can't select invalid tab value="+e);u(e),i(e),f(e)}),[i,f,l]),tabValues:l}}var g=a(2389);const k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function y(e){let{className:t,block:a,selectedValue:u,selectValue:s,tabValues:i}=e;const c=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.o5)(),d=e=>{const t=e.currentTarget,a=c.indexOf(t),r=i[a].value;r!==u&&(p(t),s(r))},h=e=>{var t;let a=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{var r;const t=c.indexOf(e.currentTarget)+1;a=null!=(r=c[t])?r:c[0];break}case"ArrowLeft":{var n;const t=c.indexOf(e.currentTarget)-1;a=null!=(n=c[t])?n:c[c.length-1];break}}null==(t=a)||t.focus()};return n.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":a},t)},i.map((e=>{let{value:t,label:a,attributes:o}=e;return n.createElement("li",(0,r.Z)({role:"tab",tabIndex:u===t?0:-1,"aria-selected":u===t,key:t,ref:e=>c.push(e),onKeyDown:h,onClick:d},o,{className:(0,l.Z)("tabs__item",k.tabItem,null==o?void 0:o.className,{"tabs__item--active":u===t})}),null!=a?a:t)})))}function b(e){let{lazy:t,children:a,selectedValue:r}=e;const l=(Array.isArray(a)?a:[a]).filter(Boolean);if(t){const e=l.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:"margin-top--md"}):null}return n.createElement("div",{className:"margin-top--md"},l.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r}))))}function v(e){const t=f(e);return n.createElement("div",{className:(0,l.Z)("tabs-container",k.tabList)},n.createElement(y,(0,r.Z)({},e,t)),n.createElement(b,(0,r.Z)({},e,t)))}function w(e){const t=(0,g.Z)();return n.createElement(v,(0,r.Z)({key:String(t)},e))}},7268:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>u,metadata:()=>i,toc:()=>p});var r=a(3117),n=(a(7294),a(3905)),l=a(4866),o=a(5162);const u={title:"Beta Releases",sidebar_label:"Beta Releases"},s=void 0,i={unversionedId:"how-tos/beta-releases",id:"how-tos/beta-releases",title:"Beta Releases",description:"Beta Releases allow you to mitigate risk of bugs by slowly rolling out a feature to your audience.",source:"@site/docs/how-tos/beta-releases.md",sourceDirName:"how-tos",slug:"/how-tos/beta-releases",permalink:"/docs/how-tos/beta-releases",draft:!1,editUrl:"https://github.com/prefab-cloud/prefab-cloud-docs-web/tree/main/docs/how-tos/beta-releases.md",tags:[],version:"current",frontMatter:{title:"Beta Releases",sidebar_label:"Beta Releases"},sidebar:"tutorialSidebar",previous:{title:"How Tos",permalink:"/docs/category/how-tos"},next:{title:"Tracking IDs",permalink:"/docs/how-tos/tracking-ids"}},c={},p=[{value:"Example rollout",id:"example-rollout",level:2},{value:"Feature flag code",id:"feature-flag-code",level:2},{value:"Rules",id:"rules",level:2},{value:"The people who worked on the feature",id:"the-people-who-worked-on-the-feature",level:3},{value:"Your entire org",id:"your-entire-org",level:3},{value:"A growing percentage of users",id:"a-growing-percentage-of-users",level:3},{value:"Exceptions",id:"exceptions",level:2},{value:"Example Screenshot",id:"example-screenshot",level:2}],d={toc:p},h="wrapper";function m(e){let{components:t,...u}=e;return(0,n.kt)(h,(0,r.Z)({},d,u,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Beta Releases allow you to mitigate risk of bugs by slowly rolling out a feature to your audience."),(0,n.kt)("p",null,"Using feature flags and Prefab's ",(0,n.kt)("a",{parentName:"p",href:"/docs/explanations/rules-and-segmentation"},"Rules and Segmentation")," you can enable a feature for precisely who you want, when you want."),(0,n.kt)("p",null,"Let's walk through a common example beta release rollout."),(0,n.kt)("h2",{id:"example-rollout"},"Example rollout"),(0,n.kt)("p",null,"A common progression for rollout is"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The people who worked on the feature: developers, designers, QA, PMs, etc."),(0,n.kt)("li",{parentName:"ol"},"Your entire org"),(0,n.kt)("li",{parentName:"ol"},"A growing percentage of users")),(0,n.kt)("p",null,"This progression allows the people who are closest to the feature to dogfood it first. Once they've fixed any rough edges they find, the rest of the org can test and uncover issues. Next you can slowly ramp up the percentage of other users the feature is available to."),(0,n.kt)("h2",{id:"feature-flag-code"},"Feature flag code"),(0,n.kt)("p",null,"You'll only need to set up the feature flag check once in your code and then you can modify the rules in the Prefab app."),(0,n.kt)("p",null,"A feature flag check will always return false until it is fully enabled or a rule returns true. This means you can ship your code at any time before a feature flag is created on Prefab and trust people are going down the ",(0,n.kt)("inlineCode",{parentName:"p"},"false")," code path."),(0,n.kt)(l.Z,{groupId:"lang",mdxType:"Tabs"},(0,n.kt)(o.Z,{value:"ruby",label:"Ruby",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-ruby"},'  if $prefab.enabled?("my-feature-name", { user: { tracking_id: current_user.tracking_id } })\n    # serve the new feature\n  else\n    # serve the old version of the page\n  end\n'))),(0,n.kt)(o.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-java"},'  if(featureFlagClient.featureIsOnFor(\n      "my-feature-name",\n      user.getLookupKey(),\n      Map.of("email", user.getEmailDomain())\n    )){\n    // serve the new feature\n  } else {\n    // serve the old version of the page\n  }\n'))),(0,n.kt)(o.Z,{value:"elixir",label:"Elixir",mdxType:"TabItem"},(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-elixir"},'  enabled = Prefab.Client.enabled?(\n    client,\n    "my-feature-name",\n    lookup_key: current_user.lookup_key,\n    attributes: [email: current_user.email_domain]\n  )\n\n  case enabled do\n    true -> # serve the new feature\n    false -> # serve the old version of the page\n  end\n')))),(0,n.kt)("h2",{id:"rules"},"Rules"),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Rules are evaluated in order. You can drag and drop rules to rearrange them. The first matching rule determines which variant is served. ",(0,n.kt)("a",{parentName:"p",href:"/docs/explanations/rules-and-segmentation"},"Read more"),".")),(0,n.kt)("p",null,'To model the example rollout above in Prefab, we\'ll create a "Simple Flag".'),(0,n.kt)("p",null,"We'll modify the default ",(0,n.kt)("inlineCode",{parentName:"p"},"When Active")," rule to return ",(0,n.kt)("inlineCode",{parentName:"p"},"false")," so we can safely ship and activate our flag while still returning ",(0,n.kt)("inlineCode",{parentName:"p"},"false")," for everyone for now."),(0,n.kt)("p",null,"Toggle the flag to active. Sync the changes to the API."),(0,n.kt)("h3",{id:"the-people-who-worked-on-the-feature"},"The people who worked on the feature"),(0,n.kt)("p",null,"Use a ",(0,n.kt)("inlineCode",{parentName:"p"},"Lookup Key In")," rule to target specific users and return the ",(0,n.kt)("inlineCode",{parentName:"p"},"true")," variant if the user matches. Lookup keys are delimited by commas, so you might target ",(0,n.kt)("inlineCode",{parentName:"p"},"developer-1234,designer-29,developer-456")," etc. When it matches, we'll serve variant ",(0,n.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"lookup key screenshot",src:a(6150).Z,width:"2160",height:"536"})),(0,n.kt)("p",null,'Click "Create Rule" and then move this rule up above our ',(0,n.kt)("inlineCode",{parentName:"p"},"Always True")," rule and sync changes to the API."),(0,n.kt)("p",null,"Once time has passed and we're ready to open this up further, we'll add our next rule."),(0,n.kt)("h3",{id:"your-entire-org"},"Your entire org"),(0,n.kt)("p",null,"Use a ",(0,n.kt)("inlineCode",{parentName:"p"},"Property Ends With One Of")," rule to target the ",(0,n.kt)("inlineCode",{parentName:"p"},"email")," property and set the criteria values to ",(0,n.kt)("inlineCode",{parentName:"p"},"@YOUR_DOMAIN.com"),". When it matches, we'll serve variant ",(0,n.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,n.kt)("p",null,'Click "Create Rule" and sync changes to the API.'),(0,n.kt)("p",null,"Time passes while the org tests the feature. Once we're confident that we're ready for customers to see this, we add our final rule."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"your org",src:a(6150).Z,width:"2160",height:"536"})),(0,n.kt)("h3",{id:"a-growing-percentage-of-users"},"A growing percentage of users"),(0,n.kt)("p",null,"We'll modify our ",(0,n.kt)("inlineCode",{parentName:"p"},"When Active")," allocation to do a ",(0,n.kt)("inlineCode",{parentName:"p"},"Percentage rollout"),". We'll start small -- maybe ",(0,n.kt)("inlineCode",{parentName:"p"},"5%")," for the ",(0,n.kt)("inlineCode",{parentName:"p"},"true")," variant and ",(0,n.kt)("inlineCode",{parentName:"p"},"95%")," for the false variant."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"percentage screenshot",src:a(2403).Z,width:"1214",height:"884"})),(0,n.kt)("p",null,"Sync your changes."),(0,n.kt)("p",null,"This is the fun part where you talk to customer support and watch your error tracker."),(0,n.kt)("p",null,"What if things are broken? You can edit the ",(0,n.kt)("inlineCode",{parentName:"p"},"Always True")," rule to serve the ",(0,n.kt)("inlineCode",{parentName:"p"},"true")," variant to ",(0,n.kt)("inlineCode",{parentName:"p"},"0%")," of people while you fix bugs. Now your customers are using the old code path again immediately."),(0,n.kt)("p",null,"Once you've dealt with any issues, you can slowly ramp the ",(0,n.kt)("inlineCode",{parentName:"p"},"5%")," up to ",(0,n.kt)("inlineCode",{parentName:"p"},"100%"),", syncing to the API and watching for issues each time."),(0,n.kt)("h2",{id:"exceptions"},"Exceptions"),(0,n.kt)("p",null,"What if you want to roll this feature out slowly but you need to make sure that your biggest customer doesn't see it until you have successfully rolled it out to everyone else first?"),(0,n.kt)("p",null,'No problem. Using what we learned with our "Your entire org" rule, we can create a rule that always returns ',(0,n.kt)("inlineCode",{parentName:"p"},"false")," for this customer."),(0,n.kt)("p",null,"Use a ",(0,n.kt)("inlineCode",{parentName:"p"},"Property Ends With One Of")," rule to target the ",(0,n.kt)("inlineCode",{parentName:"p"},"email")," property and set the criteria values to ",(0,n.kt)("inlineCode",{parentName:"p"},"@CUSTOMER_DOMAIN.com"),". When it matches, we'll serve variant ",(0,n.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"exception",src:a(9064).Z,width:"2160",height:"668"})),(0,n.kt)("p",null,'Click "Create Rule" and then move this rule up above our ',(0,n.kt)("inlineCode",{parentName:"p"},"Always True")," rule and sync changes to the API."),(0,n.kt)("p",null,"Because rule evaluation happens in order, when we see that the user matches ",(0,n.kt)("inlineCode",{parentName:"p"},"@CUSTOMER_DOMAIN.com")," we'll return ",(0,n.kt)("inlineCode",{parentName:"p"},"false")," for the flag check and they won't see the new feature."),(0,n.kt)("p",null,"Once you've ramped the percentage up to ",(0,n.kt)("inlineCode",{parentName:"p"},"100%")," for the ",(0,n.kt)("inlineCode",{parentName:"p"},"Always True")," rule and you're ready for this customer to see the feature, you can delete this exception rule."),(0,n.kt)("h2",{id:"example-screenshot"},"Example Screenshot"),(0,n.kt)("p",null,"Here's all the rules above and the exception as seen in the UI"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"example screenshot",src:a(4129).Z,width:"1322",height:"1356"})))}m.isMDXComponent=!0},4129:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/all-rules-4ca6ddaa31ff73375ccd3ff05811cf46.png"},9064:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/exception-2eaf8db305aeecd9d81a7d79a7a95860.jpg"},6150:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/lookup-key-in-a6d7f2518119fd91c5cfabac2267f1f9.jpg"},2403:(e,t,a)=>{a.d(t,{Z:()=>r});const r=a.p+"assets/images/percentage-rollout-2e035fd173cda93c2b6bdf77c3b01552.png"}}]);