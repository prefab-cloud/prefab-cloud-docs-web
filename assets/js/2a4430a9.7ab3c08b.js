"use strict";(self.webpackChunkprefab_cloud_docs_web=self.webpackChunkprefab_cloud_docs_web||[]).push([[3083],{5248:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var s=n(4848),a=n(8453);const o={title:"Best Practices & Tips",sidebar_label:"Best Practices",sidebar_position:3},i=void 0,r={id:"tutorials/best-practices",title:"Best Practices & Tips",description:"Getting Prefab installed is great, but there are some Tips & Best Practices that will help you get the most out of your Prefab experience.",source:"@site/docs/tutorials/best-practices.md",sourceDirName:"tutorials",slug:"/tutorials/best-practices",permalink:"/docs/tutorials/best-practices",draft:!1,unlisted:!1,editUrl:"https://github.com/prefab-cloud/prefab-cloud-docs-web/tree/main/docs/tutorials/best-practices.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Best Practices & Tips",sidebar_label:"Best Practices",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Your First Config and Flag",permalink:"/docs/tutorials/first-config-and-flag"},next:{title:"Example Applications",permalink:"/docs/tutorials/example-applications"}},l={},c=[{value:"Improve your contexts",id:"improve-your-contexts",level:2},{value:"Use PermanentKeys, Not Anonymous",id:"use-permanentkeys-not-anonymous",level:3},{value:"Use Names",id:"use-names",level:3},{value:"Use Multi-Context",id:"use-multi-context",level:3},{value:"Try the Context Playground",id:"try-the-context-playground",level:2},{value:"Configs vs Flags",id:"configs-vs-flags",level:2},{value:"Explore Advanced Datatypes",id:"explore-advanced-datatypes",level:2},{value:"Duration",id:"duration",level:3},{value:"JSON",id:"json",level:3},{value:"Slack Integration",id:"slack-integration",level:2},{value:"Install Editor tools",id:"install-editor-tools",level:2},{value:"Cron Job Contexts",id:"cron-job-contexts",level:2},{value:"Get yourself a Firealarm",id:"get-yourself-a-firealarm",level:2},{value:"Advanced Firealarms",id:"advanced-firealarms",level:3}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components},{TabItem:o,Tabs:i}=t;return o||u("TabItem",!0),i||u("Tabs",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"Getting Prefab installed is great, but there are some Tips & Best Practices that will help you get the most out of your Prefab experience."}),"\n",(0,s.jsx)(t.h2,{id:"improve-your-contexts",children:"Improve your contexts"}),"\n",(0,s.jsxs)(t.p,{children:["We use ",(0,s.jsx)(t.a,{href:"/docs/explanations/concepts/context",children:"Context"})," to tell Prefab the current state of the world so it can run the rules engine and give you the right values. One of the most common things we see is people setting only very basic context."]}),"\n",(0,s.jsx)(t.h3,{id:"use-permanentkeys-not-anonymous",children:"Use PermanentKeys, Not Anonymous"}),"\n",(0,s.jsxs)(i,{groupId:"lang",children:[(0,s.jsx)(o,{value:"simple",label:"Barebones",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:" {\n  user: {id: 123}\n }\n // and\n {\n  user: {anonymous: true}  // no way to target / debug this particular anonymous user\n }\n"})})}),(0,s.jsx)(o,{value:"better",label:"Prefer: Use the 'key' attribute",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:' {\n  user: {key: "4f4b2b2b-2b2b-2b2b-2b2b-2b2b2b2b2b2b", \n         id: 123,\n  }\n }\n  // and\n {\n  user: {key: "2e2b2b2b-2b2b-2b2b-2b2b-2b2b2b2b2b2b"} // a permanent key for an anonymous user allows us to target / debug this user\n }\n'})})})]}),"\n",(0,s.jsx)(t.h3,{id:"use-names",children:"Use Names"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"key"})," is the special attribute that Prefab uses to determine the canonical identifier for a context. It's used for things like debugging, logging, and matching context across requests. That's great, but GUIDs aren't very easy on the eyes. Use the ",(0,s.jsx)(t.code,{children:"name"})," attribute and Prefab will use that in the UI instead of the ",(0,s.jsx)(t.code,{children:"key"}),"."]}),"\n",(0,s.jsxs)(i,{groupId:"lang",children:[(0,s.jsx)(o,{value:"simple",label:"Barebones",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:' {\n  user: {key: "2e2b2b2b-2b2b-2b2b-2b2b-2b2b2b2b2b2b"}\n }\n'})})}),(0,s.jsx)(o,{value:"better",label:"Prefer: Add a name",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:' {\n  user: {key: "2e2b2b2b-2b2b-2b2b-2b2b-2b2b2b2b2b2b", \n         name: "John Doe" // UI will use this name in the Context & Debugger UIs\n        }\n }\n'})})})]}),"\n",(0,s.jsx)(t.h3,{id:"use-multi-context",children:"Use Multi-Context"}),"\n",(0,s.jsxs)(t.p,{children:["Some feature flag tools only allow a single set of attributes / properties to be set for a context. Prefab allows you to set multiple contexts for a single request. This is great for things like user context and team context, and helps when you want to target other things like a ",(0,s.jsx)(t.code,{children:"deployment"})," or ",(0,s.jsx)(t.code,{children:"request"}),". If you set a ",(0,s.jsx)(t.code,{children:"key"})," we'll use that as the canonical identifier for the context. If you don't want the context to be indexed, just don't set the ",(0,s.jsx)(t.code,{children:"key"}),"."]}),"\n",(0,s.jsxs)(i,{groupId:"lang",children:[(0,s.jsx)(o,{value:"simple",label:"Team jammed into the user context",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:' {\n  user: {key: 123, \n         name: "John Doe",\n         team_id: 453\n  }\n }\n'})})}),(0,s.jsx)(o,{value:"better",label:"Prefer: Separate out the team so it can have it's own Name",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:' {\n  user: {key: 123,\n         name: "John Doe",\n  },\n  team: {key: 456, \n         name: "Foo Corp"} \n  },\n  request: {\n    path: "/dashboard/profile"\n  }\n }\n'})})})]}),"\n",(0,s.jsx)(t.h2,{id:"try-the-context-playground",children:"Try the Context Playground"}),"\n",(0,s.jsx)(t.p,{children:"Is a flag not evaluating the way you expect? We've got tools to help."}),"\n",(0,s.jsxs)(t.p,{children:["Some users miss the ",(0,s.jsx)(t.a,{href:"/docs/tools/debugger",children:"Context Playground & Debugger"})," tools that Prefab provides to help you understand how Contexts work and how they're used in your application."]}),"\n",(0,s.jsx)(t.p,{children:"These tools let you see the live contexts that are being used in your application, which can help you understand why a flag is or isn't evaluating the way you expect. Check them out."}),"\n",(0,s.jsx)(t.h2,{id:"configs-vs-flags",children:"Configs vs Flags"}),"\n",(0,s.jsx)(t.p,{children:"Many feature flag tools just have flags. Prefab has both flags and configs. What's the difference? When should you use one over the other?"}),"\n",(0,s.jsx)(t.p,{children:"Here's the basic guideline:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"FF are designed for things that are ephemeral"}),"\n",(0,s.jsx)(t.li,{children:"Configs are designed for things that are permanent"}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Under the covers, these objects are very similar. But in practice, we've found that these are two different concepts and that they are each deserving of their own user interface."}),"\n",(0,s.jsx)(t.p,{children:"Sometimes we have ephemeral things. We're doing a rollout, we're launching something and we want to be able to turn it on and off while we verify that we like it. These are flags."}),"\n",(0,s.jsx)(t.p,{children:"Other times we have things that are more permanent,"}),"\n",(0,s.jsxs)(t.p,{children:["In both cases we want to be able to have sophisticated targeting rules based on context. But for config it's pretty common that we may have no targeting rules at all. Something like the ",(0,s.jsx)(t.code,{children:"http.timeout"})," is a great example. It's a great piece of configuration that we may want the option to change, but it may also just sit at 10 seconds for all time."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"One caveat: you can't do percent rollout today for Configs. We'll address this in the future. Please chat with us if this is blocking you today."})}),"\n",(0,s.jsx)(t.h2,{id:"explore-advanced-datatypes",children:"Explore Advanced Datatypes"}),"\n",(0,s.jsx)(t.h3,{id:"duration",children:"Duration"}),"\n",(0,s.jsxs)(t.p,{children:["Ever written ",(0,s.jsx)(t.code,{children:"http.connect(timeout: Prefab.get(\"my.timeout'))"})," and been worried that someone might use millisecond or seconds or minutes? Naming all your time duration configs ",(0,s.jsx)(t.code,{children:"kafka.retry.timeout-in-seconds"})," to try to be really explicit? We've got a better way!"]}),"\n",(0,s.jsxs)(t.p,{children:["Durations is a type of config that acts like the ",(0,s.jsx)(t.code,{children:"java.time.Duration"})," object or ",(0,s.jsx)(t.code,{children:"ActiveSupport::Duration"})," in Ruby. You can specify it in whatever units you like and then retrieve it in whatever units you like. Under the covers it's stored as an ISO 8601 duration."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"duration datatype",src:n(8161).A+"",width:"736",height:"762"})}),"\n",(0,s.jsx)(t.p,{children:"Then you can use it in code and be explicit about the units you want"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",children:'duration = Prefab.get("mysql.timeout")\n\nmysql.connect(timeout: duration.in_milliseconds) // 80000\nmysql.connect(timeout: duration.in_seconds)      // 80\nmysql.connect(timeout: duration.in_minutes)      // 1.5\nmysql.connect(timeout: duration.in_days)         // 0.00001\n'})}),"\n",(0,s.jsx)(t.h3,{id:"json",children:"JSON"}),"\n",(0,s.jsx)(t.p,{children:"Sometimes your config is more complex than a simple string or number. You might have a JSON object that you want to store in Prefab. That's where the JSON datatype comes in. Prefab will store it as a JSON object and you can retrieve it as a JSON object."}),"\n",(0,s.jsx)(t.h2,{id:"slack-integration",children:"Slack Integration"}),"\n",(0,s.jsxs)(t.p,{children:["An easy way to get more out of your Prefab experience is to setup the ",(0,s.jsx)(t.a,{href:"/docs/tools/slack-integration",children:"Slack Integration"}),". It's a great way to get notifications when things are changed and see how your team is using Prefab."]}),"\n",(0,s.jsx)(t.h2,{id:"install-editor-tools",children:"Install Editor tools"}),"\n",(0,s.jsxs)(t.p,{children:["Don't forget to install the ",(0,s.jsx)(t.a,{href:"/docs/tools/editor-tools",children:"Prefab Editor Tools"})," to help you get the most out of your feature flags and configurations."]}),"\n",(0,s.jsx)(t.h2,{id:"cron-job-contexts",children:"Cron Job Contexts"}),"\n",(0,s.jsxs)(t.p,{children:["If you've got feature flags going you've likely solved how to set the context for web requests. This happens in things like a ",(0,s.jsx)(t.code,{children:"Around Actions"})," that sets the context for each web request. Cron jobs are a bit different, but the same concept applies. If we have a cron job that loops over every team and processes them, we can set the context for that processing with the same ",(0,s.jsx)(t.code,{children:"Prefab.with_context"})," pattern. In Ruby this might look like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ruby",children:"class CronJob\n  LOG = SemanticLogger[self]\n\n  def self.run_all\n    Team.all.each do |team|\n      Prefab.with_context(team: {key: team.id}) do\n        LOG.tagged(team_id: team.id) do\n          ProcessTeam.new(team).process\n        end\n      end\n    end\n  end\n"})}),"\n",(0,s.jsx)(t.p,{children:"With this example, we'll get 3 big benefits:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"We'll be able to use feature flags to control how each team is processed."}),"\n",(0,s.jsx)(t.li,{children:"We'll have great logs showing us which team was processed and when."}),"\n",(0,s.jsxs)(t.li,{children:["We'll be able to turn debug logging on for a specific team and then search logs for the ",(0,s.jsx)(t.code,{children:"team_id"})," tag."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"get-yourself-a-firealarm",children:"Get yourself a Firealarm"}),"\n",(0,s.jsx)(t.p,{children:"You know the feeling when something is wrong and you'd like to let users know that you're aware of the issue? A quick and easy way to do this is to setup a Firealarm. In it's simplest form, it's just a Prefab Config that you can use to display a message to users. Add something like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ruby",children:'<%= if Prefab.get("callouts.firealarm") %>\n  <div class="firealarm">\n    <%= Prefab.get("callouts.firealarm") %>\n  </div>\n<% end %>\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Now you can set the ",(0,s.jsx)(t.code,{children:"callouts.firealarm"})," string to ",(0,s.jsx)(t.code,{children:"We're currently performing routine system maintenance. Some reports may not populate or update immediately during this time."})," to display the message to users."]}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsx)(t.p,{children:"We're currently performing routine system maintenance. Some reports may not populate or update immediately during this time."})}),"\n",(0,s.jsx)(t.h3,{id:"advanced-firealarms",children:"Advanced Firealarms"}),"\n",(0,s.jsxs)(t.p,{children:["If you'd like more control over the appearance of the firealarm, you might like a ",(0,s.jsx)(t.code,{children:"JSON"})," datatype. This will give you a little more flexibility over the look and feel of the firealarm."]}),"\n",(0,s.jsxs)(t.p,{children:["We'll create these as a Config with a",(0,s.jsx)(t.code,{children:"JSON"}),' datatype. If your callout is Javascript/Frontend make sure to click "Send to frontend SDKs".']}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"configuring a firealarm callout",src:n(2519).A+"",width:"1331",height:"603"})}),"\n",(0,s.jsxs)(t.p,{children:["Then a bit of code to set the callout's class based on the ",(0,s.jsx)(t.code,{children:"type"})," and we'll check whether the JSON is empty."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ruby",children:'<% if !Prefab.get("callouts.firealarm").empty? %>\n  <div class="callout radius <%= Prefab.get("callouts.firealarm")["type"] %>">\n    <%= Prefab.get("callouts.firealarm")["message"] %>\n  </div>\n<% end %>\n'})}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"UI for advanced firealarm callouts",src:n(4399).A+"",width:"868",height:"139"})}),"\n",(0,s.jsxs)(t.p,{children:["Want more control? Set the current url as ",(0,s.jsx)(t.a,{href:"/docs/explanations/concepts/context",children:"Context"})," to allow you to only show the firealarm on certain pages."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}function u(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},2519:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/callouts-firealarm-config-bd100d0ad3973892a546d3e78301c8f4.jpg"},4399:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/callouts-ui-778f10008fa0faf9139697d79c89991d.jpg"},8161:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/duration-00ee80860699207772b362c3314f1e38.jpg"},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>r});var s=n(6540);const a={},o=s.createContext(a);function i(e){const t=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);