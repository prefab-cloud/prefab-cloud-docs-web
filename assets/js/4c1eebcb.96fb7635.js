"use strict";(self.webpackChunkprefab_cloud_docs_web=self.webpackChunkprefab_cloud_docs_web||[]).push([[736],{6868:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var i=n(4848),a=n(8453);const s={title:"Experiments & AB Test",sidebar_label:"Experiments"},r=void 0,o={id:"how-tos/experiment",title:"Experiments & AB Test",description:"Using Prefab for Experimentation & AB Testing",source:"@site/docs/how-tos/experiment.md",sourceDirName:"how-tos",slug:"/how-tos/experiment",permalink:"/docs/how-tos/experiment",draft:!1,unlisted:!1,editUrl:"https://github.com/prefab-cloud/prefab-cloud-docs-web/tree/main/docs/how-tos/experiment.md",tags:[],version:"current",frontMatter:{title:"Experiments & AB Test",sidebar_label:"Experiments"},sidebar:"tutorialSidebar",previous:{title:"Beta Releases",permalink:"/docs/how-tos/beta-releases"},next:{title:"Feature Opt-In",permalink:"/docs/how-tos/feature-opt-in"}},l={},c=[{value:"Using Prefab for Experimentation &amp; AB Testing",id:"using-prefab-for-experimentation--ab-testing",level:2},{value:"1) Bucketing",id:"1-bucketing",level:3},{value:"2) Exposure Tracking",id:"2-exposure-tracking",level:3},{value:"3) Conversion / Metric Tracking",id:"3-conversion--metric-tracking",level:3},{value:"4) Analysis",id:"4-analysis",level:3},{value:"The Prefab Approach",id:"the-prefab-approach",level:2},{value:"Example - Setting up an Experiment in Mixpanel",id:"example---setting-up-an-experiment-in-mixpanel",level:2},{value:"Setting up Exposure Tracking (Mixpanel example)",id:"setting-up-exposure-tracking-mixpanel-example",level:3},{value:"Verifying our Bucketing Evaluations",id:"verifying-our-bucketing-evaluations",level:2},{value:"Analyzing our Experiment",id:"analyzing-our-experiment",level:2},{value:"Testing Experiments Locally",id:"testing-experiments-locally",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h2,{id:"using-prefab-for-experimentation--ab-testing",children:"Using Prefab for Experimentation & AB Testing"}),"\n",(0,i.jsx)(t.p,{children:"There are 4 parts to running experiments:"}),"\n",(0,i.jsx)(t.h3,{id:"1-bucketing",children:"1) Bucketing"}),"\n",(0,i.jsx)(t.p,{children:'What arm of the experiment should a user be in? The control or a treatment? Sometimes this is a simple 50/50 split. Sometimes you want to take into account a "holdout group" or a "never experiment on these users" group. Sometimes you only want to experiment on Paid CPC traffic or some other user characteristic. Sometimes you want to experiment on a team level instead of user level. Or perhaps experiment by infrastructure instance. All of these questions are answered by "bucketing".'}),"\n",(0,i.jsx)(t.h3,{id:"2-exposure-tracking",children:"2) Exposure Tracking"}),"\n",(0,i.jsxs)(t.p,{children:["Now that we know which bucket the user is in, we need to write this down someplace. It's important to think of this separately from bucketing. A common mistake can occur when the code that evaluates buckets automatically records the exposure. Imagine experimenting with the contents of a modal. The underlying page will have made the request to get the experiment buckets, but we shouldn't record ",(0,i.jsx)(t.strong,{children:"exposure"})," until the modal is actually rendered."]}),"\n",(0,i.jsx)(t.h3,{id:"3-conversion--metric-tracking",children:"3) Conversion / Metric Tracking"}),"\n",(0,i.jsxs)(t.p,{children:["Conversion tracking is where we track ",(0,i.jsx)(t.code,{children:"order-placed"})," or ",(0,i.jsx)(t.code,{children:"add-to-cart"})," or ",(0,i.jsx)(t.code,{children:"cpu-usage"})," or whatever the goal of our experiment is. This is likely already in your system of record."]}),"\n",(0,i.jsx)(t.h3,{id:"4-analysis",children:"4) Analysis"}),"\n",(0,i.jsx)(t.p,{children:"This is the big one. We need a tool that will look at our funnel from Exposure to Conversion. We are almost certainly going to want to be able to segment the data and slice and dice. We are making business decisions based on the results here, so we should do analysis in the source of truth. This is often the data warehouse and whatever analysis tool you have on top of it, but it may also be your product analytics suite."}),"\n",(0,i.jsx)(t.h2,{id:"the-prefab-approach",children:"The Prefab Approach"}),"\n",(0,i.jsxs)(t.p,{children:["Prefab is designed to give you a terrific solution to ",(0,i.jsx)(t.strong,{children:"targeting & bucketing"}),", that works with ",(0,i.jsx)(t.strong,{children:"your existing analysis tool"}),". In order to do AB test analysis inside a FeatureFlag tool, you would need to extract the conversion data and analysis segments from your source of truth and ingest them in the FeatureFlag tool. While not impossible, this leads to multiple sources of truth and conflicting results. So choose the analysis tool that works for your org and Prefab will turn it into an experiment machine."]}),"\n",(0,i.jsx)(t.h2,{id:"example---setting-up-an-experiment-in-mixpanel",children:"Example - Setting up an Experiment in Mixpanel"}),"\n",(0,i.jsx)(t.p,{children:"Let's walk through an example of adding experimentation to Mixpanel by bucketing users in Prefab."}),"\n",(0,i.jsxs)(t.p,{children:["First we'll create a new experiment: ",(0,i.jsx)(t.code,{children:"experiment.ex-2.bigger-button"}),". We'll do it as type ",(0,i.jsx)(t.code,{children:"string"})," rather than a boolean so that we can have nice ",(0,i.jsx)(t.code,{children:"Control"})," and ",(0,i.jsx)(t.code,{children:"Treatment"})," variants (and leave ourselves the option of a ",(0,i.jsx)(t.code,{children:"Holdout"})," option).\n",(0,i.jsx)(t.img,{alt:"image",src:n(5930).A+"",width:"1820",height:"669"}),"\nNext we'll add these ",(0,i.jsx)(t.code,{children:"Control"})," and ",(0,i.jsx)(t.code,{children:"Treatment"})," variants.\n",(0,i.jsx)(t.img,{alt:"image",src:n(828).A+"",width:"1812",height:"483"}),"\nWe'll select ",(0,i.jsx)(t.code,{children:"Perent Rollout"})," for the value.\n",(0,i.jsx)(t.img,{alt:"image",src:n(3787).A+"",width:"1813",height:"507"}),'\nWe can choose to "split evenly". Note the sticky property. This tells us which piece of ',(0,i.jsx)(t.a,{href:"/docs/explanations/concepts/context",children:"Context"})," to use to seed the random bucket generator. Our application sets context like ",(0,i.jsx)(t.code,{children:"{user: {key: '123-45f', name: 'Bob Beemer'}}"})," so ",(0,i.jsx)(t.code,{children:"user.key"})," is the correct way to be sticky here. This will ensure that any user that is bucketed into the ",(0,i.jsx)(t.code,{children:"Treatment"})," stays in the treatment everytime they use the application.\n",(0,i.jsx)(t.img,{alt:"image",src:n(3774).A+"",width:"1373",height:"448"})]}),"\n",(0,i.jsx)(t.h3,{id:"setting-up-exposure-tracking-mixpanel-example",children:"Setting up Exposure Tracking (Mixpanel example)"}),"\n",(0,i.jsxs)(t.p,{children:["Mixpanel has specific event format for ",(0,i.jsx)(t.a,{href:"https://docs.mixpanel.com/docs/reports/apps/experiments#add-experiments-to-an-implementation",children:"tracking experiment exposures"}),". When we expose a user to an experiment, we just need to call ",(0,i.jsx)(t.code,{children:"mixpanel.track('$experiment_started', {'Experiment name': 'Test', 'Variant name': 'v1'})"}),". The easiest way to integrate this with Prefab is to use the ",(0,i.jsx)(t.code,{children:"afterEvaluationCallback"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"const options = {\n    apiKey: window.prefab_api_key,\n    context: new prefabNamespace.Context({\n        user:\n            {\n                key: user.tracking_id,\n                name: user.user_name\n            }\n    }),\n    afterEvaluationCallback: (key, value) => {\n      if (key.startsWith(\"experiment\")) {   // we'll name our experiments to start with 'experiment'\n        mixpanel.track('$experiment_started', {\n          'Experiment name': key,           // this will be 'experiment.ex-2.bigger-button'\n          'Variant name': value             // this will be 'Control' or 'Treatment'\n        });\n      }\n    }\n};\n"})}),"\n",(0,i.jsx)(t.p,{children:"We will of course need to actually call the experiment in our code."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"if(prefab.get('experiment.ex-2.bigger-button') === \"Treatment\"){\n    // do something new\n} else {\n    // do existing logic\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"With that setup, we can run our application. 50% of users will see our new and 50% our existing logic."}),"\n",(0,i.jsx)(t.h2,{id:"verifying-our-bucketing-evaluations",children:"Verifying our Bucketing Evaluations"}),"\n",(0,i.jsxs)(t.p,{children:["A crucial part of bucketing is giving you confidence that the bucketing is happening as you expect. Prefab evaluation charts are very useful here. This is showing us that at our low amount of traffic in staging the 50%/50% split is really a 54%/46% split. We'll expect to see this track to 50%/50% over time.\n",(0,i.jsx)(t.img,{alt:"image",src:n(7859).A+"",width:"1507",height:"1319"})]}),"\n",(0,i.jsx)(t.h2,{id:"analyzing-our-experiment",children:"Analyzing our Experiment"}),"\n",(0,i.jsxs)(t.p,{children:["In Mixpanel, we can now setup a funnel report. The conversion event for this example will be an event  called ",(0,i.jsx)(t.code,{children:"PrefabLandingPage"})," that we have triggered via basic ",(0,i.jsx)(t.code,{children:"mixpanel.track('PrefabLandingPage');"})," calls."]}),"\n",(0,i.jsxs)(t.p,{children:["Here's the setup for our two step funnel:\n",(0,i.jsx)(t.img,{alt:"image",src:n(2821).A+"",width:"619",height:"543"})]}),"\n",(0,i.jsxs)(t.p,{children:["We set the first step of the funnel to be the ",(0,i.jsx)(t.code,{children:"Experiment Started"})," event, filtered to where the ",(0,i.jsx)(t.code,{children:"Experiment Name"})," is ",(0,i.jsx)(t.code,{children:"experiment.ex-2.bigger-button"}),".  The second event is conversion goal, in our example ",(0,i.jsx)(t.code,{children:"PrefabLandingPage"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.strong,{children:"tricky part"}),' is that we can now do a "conversion rate segmentation" and "breakdown". We want to segment on the value of ',(0,i.jsx)(t.code,{children:"Variant Name"})," in ",(0,i.jsx)(t.code,{children:"Step 1"}),". Here's what that looks like:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"image",src:n(8253).A+"",width:"612",height:"726"})}),"\n",(0,i.jsxs)(t.p,{children:["Success! We can see our AB Test in it's full glory. We can see that we have some separation in the conversion rate between the two arms. Mixpanel is actually labeling this as a significant conversion change.\n",(0,i.jsx)(t.img,{alt:"image",src:n(2425).A+"",width:"2214",height:"1245"})]}),"\n",(0,i.jsx)(t.h2,{id:"testing-experiments-locally",children:"Testing Experiments Locally"}),"\n",(0,i.jsx)(t.p,{children:"As a developer building out the new feature. It's pretty common to want to be able to quickly toggle back and forth between the variants of your experiment. You could do this by just changing the development value, but that will affect everyone on your team."}),"\n",(0,i.jsxs)(t.p,{children:["Prefab's ",(0,i.jsx)(t.a,{href:"/docs/tools/cli",children:"developer tools"})," have you covered. Because the CLI knows who you are, it can easily add and remove a targeted override just for you. Here's what that looks like:\n",(0,i.jsx)(t.img,{alt:"image",src:n(9795).A+"",width:"885",height:"243"})]}),"\n",(0,i.jsxs)(t.p,{children:["And here's the resulting rule that you'll see in the Prefab UI.\n",(0,i.jsx)(t.img,{alt:"image",src:n(5229).A+"",width:"559",height:"471"})]}),"\n",(0,i.jsx)(t.p,{children:"Happy experimenting!"})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},5229:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/exp-override-6317c4f4ed1c2aededc8dbee585de7c7.jpg"},5930:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/exp-prefab-create-1a6327f1aa09a4073020d69dcf61d767.jpg"},3787:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/exp-prefab-percent-rollout-89315e6921d16657f51fcee74b8e8446.jpg"},3774:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/exp-prefab-split-evenly-dafdd4c7907e7e4a3827f89ca301592f.jpg"},828:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/exp-prefab-variants-42157b2e6806f438bc8a8d88d28525a1.jpg"},8253:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/mixpanel-breakdown-5789f5d18e0265a4399041485a38511b.jpg"},2425:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/mixpanel-significant-5b22bfd420652ac924f31470d65a9569.jpg"},2821:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/mixpanel-steps-396566e0e682f4943ad6757323f01eff.jpg"},9795:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/prefab-cli-anim-49d7eca94f471cce4921ee54b80e5ae6.gif"},7859:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/prefab-evaluations-160d8b593f85214069de0e287e244bf0.jpg"},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>o});var i=n(6540);const a={},s=i.createContext(a);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);