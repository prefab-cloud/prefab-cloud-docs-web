"use strict";(self.webpackChunkprefab_cloud_docs_web=self.webpackChunkprefab_cloud_docs_web||[]).push([[1299],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>f});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},l=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,f=u["".concat(s,".").concat(d)]||u[d]||m[d]||r;return n?a.createElement(f,i(i({ref:t},l),{},{components:n})):a.createElement(f,i({ref:t},l))}));function f(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c[u]="string"==typeof e?e:o,i[1]=c;for(var p=2;p<r;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3373:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var a=n(7462),o=(n(7294),n(3905));const r={title:"Namespaces",sidebar_label:"Namespaces",sidebar_position:4},i=void 0,c={unversionedId:"explanations/concepts/namespaces",id:"explanations/concepts/namespaces",title:"Namespaces",description:"Targeting Dynamic Configuration With Namespaces",source:"@site/docs/explanations/concepts/namespaces.md",sourceDirName:"explanations/concepts",slug:"/explanations/concepts/namespaces",permalink:"/docs/explanations/concepts/namespaces",draft:!1,editUrl:"https://github.com/prefab-cloud/prefab-cloud-docs-web/tree/main/docs/explanations/concepts/namespaces.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Namespaces",sidebar_label:"Namespaces",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Context",permalink:"/docs/explanations/concepts/context"},next:{title:"Testing & DataFiles",permalink:"/docs/explanations/concepts/testing"}},s={},p=[{value:"Targeting Dynamic Configuration With Namespaces",id:"targeting-dynamic-configuration-with-namespaces",level:2}],l={toc:p},u="wrapper";function m(e){let{components:t,...n}=e;return(0,o.kt)(u,(0,a.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"targeting-dynamic-configuration-with-namespaces"},"Targeting Dynamic Configuration With Namespaces"),(0,o.kt)("p",null,"Namespaces is just a useful way to use context to allow you to share config amongst many services while still allowing you to override when necessary."),(0,o.kt)("p",null,"For instance, let's assume that all our code shares an HTTP library. We can configure the HTTP library to get its retry count & timeout duration from our config store.\nWe'll set ",(0,o.kt)("inlineCode",{parentName:"p"},"http.connection.retries")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"http.connection.timeout"),"."),(0,o.kt)("p",null,"Each of our applications will declare their ",(0,o.kt)("inlineCode",{parentName:"p"},"application.key"),". For instance our authorization service may have the following config:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},'  around_action do |_, block|\n    Prefab.with_context(prefab_context, &block)\n  end\n\n  def prefab_context\n    ctx = {\n      application: {\n        key: "authorization-service",\n        type: "web"\n      },\n    }\n  end  \n')),(0,o.kt)("p",null,"All of our apps should add the appropriate service name in their ",(0,o.kt)("inlineCode",{parentName:"p"},"application.key"),"."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"It's likely that you have a good namespace already defined as a tag on your pod. Something like ",(0,o.kt)("inlineCode",{parentName:"p"},'(ENV[\'DEPLOYED_NAME\'] || "").gsub("-",".")')," may be just what you're looking for.")),(0,o.kt)("p",null,"Our client code can now look for ",(0,o.kt)("inlineCode",{parentName:"p"},"http.connection.timeout")," but we can override it for specific applications. "),(0,o.kt)("p",null,"Let's imagine that the UserService starts to go down because too many requests are timing out to our billing service. We can replicate a circuit breaker pattern here by quickly reducing the ",(0,o.kt)("inlineCode",{parentName:"p"},"http.connection.timeout")," when ",(0,o.kt)("inlineCode",{parentName:"p"},"application.key")," is ",(0,o.kt)("inlineCode",{parentName:"p"},"user-service")," to solve the issue without pushing code or restarting. "),(0,o.kt)("p",null,"In that example, we'd actually be changing all outgoing HTTP timeouts from the user service, which is probably more than we'd like. To be more precise, we can add additional just-in-time (JIT) context to the timeout lookups to allow us even more fine grained control."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ruby"},'def call_billing_service\n  conn = Faraday.new do |conn|\n    conn.options.timeout = Prefab.get("http.connection.timeout", { http: { endpoint: "billing" } })\n  end\n  response = conn.get("https://billing-service.example.comcom")\nend  \n')),(0,o.kt)("p",null,"With this JIT context, we can now target the ",(0,o.kt)("inlineCode",{parentName:"p"},"http.connection.timeout")," for only calls from the user service to the billing service, by targeting both ",(0,o.kt)("inlineCode",{parentName:"p"},"app.key")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"http.endpoint"),"."))}m.isMDXComponent=!0}}]);